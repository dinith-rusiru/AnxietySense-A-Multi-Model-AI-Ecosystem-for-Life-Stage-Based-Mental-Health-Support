<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anxiety Level Prediction System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.95em;
        }

        .progress-container {
            margin-bottom: 30px;
        }

        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            font-weight: 600;
            font-size: 1.1em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #444;
            font-weight: 500;
        }

        input[type="number"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .question-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            margin-bottom: 20px;
        }

        .question-number {
            color: #667eea;
            font-weight: 600;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .question-text {
            font-size: 1.05em;
            color: #333;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 12px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .radio-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .radio-option input[type="radio"] {
            margin-right: 10px;
            cursor: pointer;
            width: 18px;
            height: 18px;
        }

        .radio-option label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
            flex: 1;
        }

        .radio-option input[type="radio"]:checked + label {
            font-weight: 600;
            color: #667eea;
        }

        .button-container {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .result-container {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
        }

        .result-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .result-item {
            background: white;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-value {
            font-weight: 600;
            font-size: 1.1em;
            color: #667eea;
        }

        .probability-bars {
            margin-top: 15px;
        }

        .probability-item {
            margin-bottom: 12px;
        }

        .probability-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .probability-bar {
            height: 25px;
            background: #e9ecef;
            border-radius: 12px;
            overflow: hidden;
        }

        .probability-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.85em;
            font-weight: 600;
        }

        .error {
            background: #fee;
            border: 2px solid #fcc;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .error.show {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß† Anxiety Level Prediction</h1>
        <p class="subtitle">Complete the questionnaire to assess your anxiety level</p>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            <div class="progress-text" id="progressText">Page 1 of 4</div>
        </div>

        <!-- Page 1: Demographics -->
        <div class="page active" id="page1">
            <div class="section-title">üìã Demographics Information</div>
            
            <div class="form-group">
                <label for="age">Age:</label>
                <input type="number" id="age" min="18" max="120" required>
            </div>

            <div class="form-group">
                <label for="gender">Gender:</label>
                <select id="gender" required>
                    <option value="">Select gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label for="lives_alone">Living Situation:</label>
                <select id="lives_alone" required>
                    <option value="">Select</option>
                    <option value="0">Lives with others</option>
                    <option value="1">Lives alone</option>
                </select>
            </div>

            <div class="button-container">
                <button class="btn btn-primary" onclick="nextPage()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Page 2: Cognitive Questions -->
        <div class="page" id="page2">
            <div class="section-title">üß© Cognitive Symptoms (Questions 1-10)</div>
            <div id="cognitive-questions"></div>
            <div class="button-container">
                <button class="btn btn-secondary" onclick="prevPage()">‚Üê Back</button>
                <button class="btn btn-primary" onclick="nextPage()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Page 3: Somatic Questions -->
        <div class="page" id="page3">
            <div class="section-title">üí™ Somatic Symptoms (Questions 11-20)</div>
            <div id="somatic-questions"></div>
            <div class="button-container">
                <button class="btn btn-secondary" onclick="prevPage()">‚Üê Back</button>
                <button class="btn btn-primary" onclick="nextPage()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Page 4: Affective Questions -->
        <div class="page" id="page4">
            <div class="section-title">‚ù§Ô∏è Affective Symptoms (Questions 21-30)</div>
            <div id="affective-questions"></div>
            <div class="button-container">
                <button class="btn btn-secondary" onclick="prevPage()">‚Üê Back</button>
                <button class="btn btn-primary" onclick="submitForm()">Get Prediction</button>
            </div>
        </div>

        <!-- Page 5: Results -->
        <div class="page" id="page5">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analyzing your responses...</p>
            </div>

            <div class="error" id="error"></div>

            <div class="result-container" id="results" style="display: none;">
                <div class="result-title">üìä Prediction Results</div>
                
                <div class="result-item">
                    <span>Predicted Anxiety Level:</span>
                    <span class="result-value" id="predicted-level">-</span>
                </div>

                <div class="result-item">
                    <span>Cognitive Score:</span>
                    <span class="result-value" id="cognitive-score">-</span>
                </div>

                <div class="result-item">
                    <span>Somatic Score:</span>
                    <span class="result-value" id="somatic-score">-</span>
                </div>

                <div class="result-item">
                    <span>Affective Score:</span>
                    <span class="result-value" id="affective-score">-</span>
                </div>

                <div class="result-item">
                    <span>Total Score:</span>
                    <span class="result-value" id="total-score">-</span>
                </div>

                <div class="probability-bars" id="probabilities"></div>

                <div class="button-container">
                    <button class="btn btn-primary" onclick="goToEmotionRecognition()">Go to Emotion Recognition & Music üéµ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5001';
        let currentPage = 1;
        const totalPages = 5;
        const formData = {};

        const cognitiveQuestions = [
            "I worry excessively about different things",
            "I find it hard to control my worrying",
            "I have difficulty concentrating due to anxious thoughts",
            "I often expect the worst to happen",
            "My thoughts race when I feel anxious",
            "I feel mentally restless or on edge",
            "I struggle to relax my mind",
            "I overthink small problems",
            "I feel overwhelmed by my thoughts",
            "I have trouble making decisions because of worry"
        ];

        const somaticQuestions = [
            "I feel my heart racing or pounding",
            "I experience shortness of breath",
            "I feel tense or have muscle tightness",
            "I experience sweating without physical activity",
            "I feel dizzy or lightheaded",
            "I have stomach discomfort or nausea",
            "I feel fatigued easily",
            "I experience trembling or shaking",
            "I have headaches due to stress",
            "I feel chest tightness"
        ];

        const affectiveQuestions = [
            "I feel nervous or anxious most of the time",
            "I feel fearful without a clear reason",
            "I feel irritable easily",
            "I feel emotionally overwhelmed",
            "I feel restless or unable to sit still",
            "I feel a constant sense of unease",
            "I feel panic suddenly",
            "I feel emotionally drained",
            "I feel tense in social situations",
            "I feel anxious about the future"
        ];

        function generateQuestions() {
            const cognitiveContainer = document.getElementById('cognitive-questions');
            const somaticContainer = document.getElementById('somatic-questions');
            const affectiveContainer = document.getElementById('affective-questions');

            function createQuestion(questionText, qId, qNumber) {
                const div = document.createElement('div');
                div.className = 'question-item';

                const options = [
                    { val: 0, label: "Not at all" },
                    { val: 1, label: "Mild" },
                    { val: 2, label: "Moderate" },
                    { val: 3, label: "Severe" },
                    { val: 4, label: "Very Severe" }
                ];

                div.innerHTML = `
                    <div class="question-number">Question ${qNumber}</div>
                    <div class="question-text">${questionText}</div>
                    <div class="radio-group">
                        ${options.map(item => `
                            <div class="radio-option">
                                <input type="radio" name="${qId}" value="${item.val}" id="${qId}_${item.val}">
                                <label for="${qId}_${item.val}">${item.label}</label>
                            </div>
                        `).join('')}
                    </div>
                `;
                return div;
            }

            cognitiveQuestions.forEach((q, index) => {
                const qId = `q${String(index + 1).padStart(2, '0')}`;
                cognitiveContainer.appendChild(createQuestion(q, qId, index + 1));
            });

            somaticQuestions.forEach((q, index) => {
                const qId = `q${String(index + 11).padStart(2, '0')}`;
                somaticContainer.appendChild(createQuestion(q, qId, index + 11));
            });

            affectiveQuestions.forEach((q, index) => {
                const qId = `q${String(index + 21).padStart(2, '0')}`;
                affectiveContainer.appendChild(createQuestion(q, qId, index + 21));
            });
        }

        function updateProgress() {
            const progress = (currentPage / totalPages) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Page ${currentPage} of ${totalPages}`;
        }

        function saveCurrentPageData() {
            if (currentPage === 1) {
                formData.age = parseInt(document.getElementById('age').value);
                formData.gender = document.getElementById('gender').value;
                formData.lives_alone = parseInt(document.getElementById('lives_alone').value);
            } else {
                const radios = document.querySelectorAll(`#page${currentPage} input[type="radio"]:checked`);
                radios.forEach(radio => {
                    formData[radio.name] = parseInt(radio.value);
                });
            }
        }

        function validateCurrentPage() {
            if (currentPage === 1) {
                const age = document.getElementById('age').value;
                const gender = document.getElementById('gender').value;
                const livesAlone = document.getElementById('lives_alone').value;
                
                if (!age || !gender || livesAlone === '') {
                    alert('Please fill in all demographic fields');
                    return false;
                }
            } else if (currentPage <= 4) {
                const questions = document.querySelectorAll(`#page${currentPage} input[type="radio"]`);
                const questionNames = new Set();
                questions.forEach(q => questionNames.add(q.name));
                
                const answeredQuestions = new Set();
                questions.forEach(q => {
                    if (q.checked) answeredQuestions.add(q.name);
                });
                
                if (answeredQuestions.size !== questionNames.size) {
                    alert('Please answer all questions before proceeding');
                    return false;
                }
            }
            return true;
        }

        function nextPage() {
            if (!validateCurrentPage()) return;
            
            saveCurrentPageData();
            document.getElementById(`page${currentPage}`).classList.remove('active');
            currentPage++;
            document.getElementById(`page${currentPage}`).classList.add('active');
            updateProgress();
            window.scrollTo(0, 0);
        }

        function prevPage() {
            document.getElementById(`page${currentPage}`).classList.remove('active');
            currentPage--;
            document.getElementById(`page${currentPage}`).classList.add('active');
            updateProgress();
            window.scrollTo(0, 0);
        }

        async function submitForm() {
            if (!validateCurrentPage()) return;
            
            saveCurrentPageData();
            
            // Build complete data object
            const data = {
                age: formData.age,
                gender: formData.gender,
                lives_alone: formData.lives_alone
            };

            // Add all question responses
            for (let i = 1; i <= 30; i++) {
                const qId = `q${String(i).padStart(2, '0')}`;
                data[qId] = formData[qId] || 0;
            }

            console.log('Sending data:', data);

            // Show results page with loading
            document.getElementById(`page${currentPage}`).classList.remove('active');
            currentPage = 5;
            document.getElementById(`page${currentPage}`).classList.add('active');
            updateProgress();
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.getElementById('error').classList.remove('show');

            try {
                const response = await fetch(`${API_URL}/predict`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    displayResults(result);
                } else {
                    showError(result.error || 'Prediction failed');
                }
            } catch (error) {
                showError('Failed to connect to the server. Make sure the Flask app is running.');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        function displayResults(result) {
            document.getElementById('predicted-level').textContent = result.predicted_gas_level;
            document.getElementById('cognitive-score').textContent = result.scores.cognitive;
            document.getElementById('somatic-score').textContent = result.scores.somatic;
            document.getElementById('affective-score').textContent = result.scores.affective;
            document.getElementById('total-score').textContent = result.scores.total;

            const probContainer = document.getElementById('probabilities');
            probContainer.innerHTML = '<div style="margin-top: 20px; font-weight: 600;">Class Probabilities:</div>';

            

            document.getElementById('results').style.display = 'block';
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        function goToEmotionRecognition() {
            // Replace with the actual path to your emotion recognition page
             window.open('iindex1.html');
          
        }

        // Initialize
        generateQuestions();
        updateProgress();
    </script>
</body>
</html>